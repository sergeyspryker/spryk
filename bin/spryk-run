#!/usr/bin/env php
<?php

define('SPRYKER_ROOT', getcwd());
$rootDir = getenv('APPLICATION_ROOT_DIR');
if ($rootDir) {
    define('APPLICATION_ROOT_DIR', realpath($rootDir));
}
$autoloadPaths = [];
$sdkDir = getenv('APPLICATION_SDK_DIR');
if ($sdkDir) {
    define('APPLICATION_SDK_DIR', $sdkDir);
    $autoloadPaths[] = APPLICATION_SDK_DIR . '/vendor/autoload.php';
}
$autoloadPaths[] = SPRYKER_ROOT . '/vendor/autoload.php';
$autoloadPaths[] = __DIR__ . '/../../../../../autoload.php';
$autoloadPaths[] = __DIR__ . '/../../../autoload.php';

foreach ($autoloadPaths as $file) {
    if (file_exists($file)) {
        define('SPRYKER_COMPOSER_INSTALL', $file);
        if (!defined('APPLICATION_ROOT_DIR')) {
            define('APPLICATION_ROOT_DIR', realpath(dirname($file) . '/..'));
        }
        break;
    }
}

if (!defined('SPRYKER_COMPOSER_INSTALL')) {
    throw new \Exception('Could not resolve path to vendor/autoload.php');
}

require_once SPRYKER_COMPOSER_INSTALL;

use SprykerSdk\Spryk\Console\ConsoleBootstrap;
use SprykerSdk\Spryk\Console\SprykRunConsole;

$application = new ConsoleBootstrap();
$application->addCommands([
    new SprykRunConsole(),
]);
$application->setDefaultCommand('spryk:run', true);

$application->run();
